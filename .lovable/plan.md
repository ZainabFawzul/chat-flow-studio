

# Plan: Make Exported HTML Fully Accessible and Mobile Responsive

## Overview
Enhance the standalone HTML generated by `exportZip.ts` to meet WCAG 2.1 AA standards and the AtomicA11y chat accessibility criteria. This includes keyboard navigation, screen reader support, mobile responsiveness, and proper text resizing.

---

## Technical Implementation

### File: `src/lib/exportZip.ts`

### 1. Mobile Responsiveness (CSS)

Add responsive breakpoints and flexible layout:

```css
/* Container adapts to viewport */
.chat-container {
  max-width: 37.5rem;
  width: 100%;
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height for mobile browsers */
}

/* Responsive adjustments */
@media (max-width: 480px) {
  .chat-header { padding: 0.625rem 0.75rem; gap: 0.625rem; }
  .chat-messages { padding: 0.75rem; gap: 0.75rem; }
  .response-options { padding: 0.75rem; }
  .message-bubble { max-width: 85%; }
  .avatar { width: 2.25rem; height: 2.25rem; }
  .start-content { padding: 1rem; }
}

/* Support for 200% text zoom */
@media (min-resolution: 2dppx) {
  html { font-size: 100%; }
}
```

### 2. Skip Navigation Link

Add a skip link at the start of the body:

```html
<a href="#messages-area" class="skip-link">Skip to conversation</a>
```

With CSS:
```css
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  padding: 0.5rem 1rem;
  background: #2563eb;
  color: white;
  z-index: 100;
  text-decoration: none;
}
.skip-link:focus {
  top: 0;
}
```

### 3. Enhanced Keyboard Navigation

Update focus management to ensure meaningful tab order:

- Start button → Reset button → Response option buttons
- Messages area has `tabindex="-1"` so it can receive programmatic focus but isn't in tab order
- Response options receive focus after new messages

Add keyboard handling for Escape to reset conversation:

```javascript
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && isPlaying) {
    handleReset();
  }
});
```

### 4. Improved Screen Reader Support

**Enhanced ARIA live regions:**

```html
<!-- Polite region for new messages -->
<div id="messages-area" role="log" aria-live="polite" aria-atomic="false" 
     aria-label="Conversation messages with ${theme.contactName}">

<!-- Assertive region for status changes -->
<div aria-live="assertive" aria-atomic="true" class="sr-only" id="status-announcer"></div>
```

**Better message announcements:**
- Each message uses `role="article"` with descriptive `aria-label`
- Typing indicator uses `role="status"` with `aria-live="polite"`
- Conversation end states are announced

**Response options enhancements:**
```html
<nav class="response-options" role="group" 
     aria-labelledby="options-label"
     aria-describedby="options-instruction">
  <p class="options-label" id="options-label">Choose a response</p>
  <p class="sr-only" id="options-instruction">
    Use Tab to navigate between options, Enter to select
  </p>
```

### 5. Apply Theme Colors to Response Panel

Currently missing theme colors for response panel - add CSS variables:

```css
.response-options {
  background: hsl(${theme.responsePanelBackground ?? '0 0% 100%'});
}

.options-label {
  color: hsl(${theme.responsePanelLabelColor ?? '220 9% 35%'});
}

.option-btn {
  background: hsl(${theme.responseOptionBackground ?? '0 0% 100%'});
  color: hsl(${theme.responseOptionTextColor ?? '222 47% 11%'});
  border-radius: ${(theme.responseOptionBorderRadius ?? 12) / 16}rem;
}
```

### 6. Focus Indicator Improvements

Ensure visible focus states on all interactive elements:

```css
*:focus-visible {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}

.option-btn:focus-visible {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
}
```

### 7. Text Resizing Support

Ensure all measurements use relative units:

- Replace any remaining `px` with `rem`
- Use `clamp()` for font sizes
- Container uses percentage width with max-width
- Text wraps properly at 200% zoom

```css
body {
  font-size: clamp(0.875rem, 2.5vw, 1.125rem);
  line-height: 1.6;
}

.message-bubble {
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}
```

### 8. Scrolling Container Accessibility

Ensure messages area is properly navigable:

```html
<main class="chat-messages" 
      id="messages-area"
      role="log" 
      aria-live="polite"
      aria-label="Conversation messages"
      tabindex="-1">
```

Add visual scroll indicator and announcement:

```javascript
// Announce when user scrolls to see more messages
messagesArea.addEventListener('scroll', debounce(function() {
  // Optional: announce scroll position for very long conversations
}, 500));
```

---

## Complete Changes Summary

| Accessibility Criteria | Current State | After Changes |
|----------------------|---------------|---------------|
| Keyboard focus order | Partially implemented | Full tab order: Skip → Start/Reset → Options |
| Screen reader roles | Basic roles | Full ARIA: log, status, article, group |
| Status announcements | Basic announcer | Enhanced with typing, new message, conversation end |
| Mobile responsiveness | Fixed width | Fluid layout with breakpoints |
| 200% text zoom | Uses rem | Full support with clamp() and overflow handling |
| Skip link | Missing | Added skip to conversation |
| Focus indicators | Basic | Enhanced with ring effect |
| Response panel theming | Partial | Full theme support |

---

## Testing Recommendations

After implementation, verify with:

1. **Keyboard**: Tab through all controls in logical order
2. **NVDA/VoiceOver**: Confirm messages are announced as they appear
3. **Mobile viewport**: Test at 320px width
4. **Zoom**: Test at 200% browser zoom
5. **High contrast**: Ensure focus indicators are visible

